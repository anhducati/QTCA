<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>C·∫•u H√¨nh Qu√† T·∫∑ng V√≤ng Quay - Chung Anh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background: radial-gradient(circle at top, #1e293b, #020617);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 24px 12px;
    }
    .card {
      background: #0b1220;
      border-radius: 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(15,23,42,0.7);
      max-width: 960px;
      width: 100%;
    }
    .card-header {
      border-bottom: 1px solid #1f2937;
      background: transparent;
    }
    .form-control, .form-control:focus {
      background-color: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }
    .table-dark {
      --bs-table-bg: transparent;
    }
    .badge-soft {
      background: rgba(52,211,153,0.12);
      color: #6ee7b7;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
    }
    a, a:hover {
      color: #38bdf8;
    }
    .text-muted {
      color: #9ca3af !important;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-1">C·∫•u H√¨nh Qu√† T·∫∑ng V√≤ng Quay</h5>
        <div class="text-muted small">
          L∆∞u c·∫•u h√¨nh n√†y s·∫Ω d√πng cho <code>index.html</code> (v√≤ng quay) tr√™n c√πng tr√¨nh duy·ªát.
        </div>
      </div>
      <span class="badge-soft">LocalStorage - Kh√¥ng c·∫ßn server</span>
    </div>
    <div class="card-body">
      <div class="alert alert-secondary small" style="background:#020617;border-color:#1f2937;color:#e5e7eb">
        <ul class="mb-0">
          <li><b>T√™n qu√† t·∫∑ng</b>: n·ªôi dung s·∫Ω hi·ªÉn th·ªã tr√™n v√≤ng quay.</li>
          <li><b>T·ªïng SL</b>: s·ªë ph·∫ßn qu√† chu·∫©n b·ªã (0 = kh√¥ng gi·ªõi h·∫°n).</li>
          <li><b>C√≤n l·∫°i</b>: s·ªë ph·∫ßn qu√† c√≤n l·∫°i (m·ªói l·∫ßn tr√∫ng s·∫Ω t·ª± tr·ª´ 1).</li>
        </ul>
      </div>

      <div class="table-responsive">
        <table class="table table-dark align-middle">
          <thead>
            <tr>
              <th style="width:5%">#</th>
              <th style="width:45%">T√™n qu√† t·∫∑ng</th>
              <th style="width:20%">T·ªïng SL</th>
              <th style="width:20%">C√≤n l·∫°i</th>
              <th style="width:10%">X√≥a</th>
            </tr>
          </thead>
          <tbody id="prizeRows"></tbody>
        </table>
      </div>

      <div class="d-flex gap-2 mb-3">
        <button class="btn btn-outline-light btn-sm" id="addRowBtn">
          + Th√™m d√≤ng
        </button>
        <button class="btn btn-outline-warning btn-sm" id="resetRemainBtn">
          ƒê·∫∑t "C√≤n l·∫°i" = "T·ªïng SL"
        </button>
      </div>

      <div class="d-flex flex-wrap gap-2">
        <button class="btn btn-success" id="saveResetBtn">
          üíæ L∆∞u & Reset S·ªë L∆∞·ª£ng
        </button>
        <button class="btn btn-primary" id="saveCurrentBtn">
          üíæ L∆∞u Gi·ªØ Nguy√™n S·ªë C√≤n L·∫°i
        </button>
        <button class="btn btn-outline-danger ms-auto" id="clearAllBtn">
          üóë X√≥a to√†n b·ªô c·∫•u h√¨nh
        </button>
      </div>

      <hr />
      <div class="small text-muted">
        ‚Ä¢ Khi <b>total &gt; 0</b>: m·ªói l·∫ßn tr√∫ng, v√≤ng quay s·∫Ω t·ª± tr·ª´ 1 trong c·ªôt
        <b>C√≤n l·∫°i</b>. Khi v·ªÅ 0 ‚Üí ng∆∞·ªùi quay v·∫´n c√≥ th·ªÉ d·ª´ng v√†o √¥ ƒë√≥ nh∆∞ng s·∫Ω
        hi·ªÉn th·ªã "<i>Ch√∫c May M·∫Øn L·∫ßn Sau (H·∫øt ...)</i>" v√† kh√¥ng tr·ª´ ti·∫øp.<br />
        ‚Ä¢ Khi <b>total = 0</b>: qu√† kh√¥ng gi·ªõi h·∫°n, quay tr√∫ng bao nhi√™u c≈©ng ƒë∆∞·ª£c.<br />
        ‚Ä¢ D·ªØ li·ªáu l∆∞u d·∫°ng <b>localStorage</b> n√™n ch·ªâ √°p d·ª•ng cho <b>tr√¨nh duy·ªát/m√°y
          hi·ªán t·∫°i</b>.
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "wheel_prize_config_v1";

    function loadPrizeConfig() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      try {
        const data = JSON.parse(raw);
        if (!data || !Array.isArray(data.prizes)) return null;
        data.prizes = data.prizes.map(p => ({
          name: (p.name || "").trim(),
          total: Number.isFinite(parseInt(p.total, 10)) ? parseInt(p.total, 10) : 0,
          remaining: Number.isFinite(parseInt(p.remaining, 10))
            ? parseInt(p.remaining, 10)
            : (Number.isFinite(parseInt(p.total, 10)) ? parseInt(p.total, 10) : 0)
        }));
        return data;
      } catch(e) {
        console.warn("L·ªói ƒë·ªçc c·∫•u h√¨nh:", e);
        return null;
      }
    }

    const defaultPrizeState = [
      { name: "Gi·∫£m 50k", total: 0, remaining: 0 },
      { name: "Gi·∫£m 100k", total: 0, remaining: 0 },
      { name: "Qu√† T·∫∑ng √Åo M∆∞a", total: 0, remaining: 0 },
      { name: "B√¨nh D·∫ßu Mi·ªÖn Ph√≠", total: 0, remaining: 0 },
      { name: "R·ª≠a Xe Free", total: 0, remaining: 0 },
      { name: "Phi·∫øu B·ªëc ThƒÉm", total: 0, remaining: 0 },
      { name: "Th√™m 1 L·∫ßn Quay", total: 0, remaining: 0 },
      { name: "Ch√∫c May M·∫Øn L·∫ßn Sau", total: 0, remaining: 0 }
    ];

    const tbody = document.getElementById("prizeRows");
    const addRowBtn = document.getElementById("addRowBtn");
    const saveResetBtn = document.getElementById("saveResetBtn");
    const saveCurrentBtn = document.getElementById("saveCurrentBtn");
    const resetRemainBtn = document.getElementById("resetRemainBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");

    function createRow(index, p) {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${index + 1}</td>
        <td><input class="form-control form-control-sm name-input" value="${p.name || ""}" /></td>
        <td><input type="number" min="0" class="form-control form-control-sm total-input" value="${p.total || 0}" /></td>
        <td><input type="number" min="0" class="form-control form-control-sm remaining-input" value="${p.remaining || 0}" /></td>
        <td>
          <button class="btn btn-outline-danger btn-sm btn-remove">&times;</button>
        </td>
      `;

      tr.querySelector(".btn-remove").addEventListener("click", () => {
        tr.remove();
        renumberRows();
      });

      tbody.appendChild(tr);
    }

    function renumberRows() {
      [...tbody.querySelectorAll("tr")].forEach((tr, idx) => {
        tr.querySelector("td").textContent = idx + 1;
      });
    }

    function renderInitial() {
      const cfg = loadPrizeConfig();
      const prizes = cfg && cfg.prizes && cfg.prizes.length
        ? cfg.prizes
        : defaultPrizeState;

      tbody.innerHTML = "";
      prizes.forEach((p, idx) => createRow(idx, p));
    }

    function collectRows({ resetRemaining = false } = {}) {
      const rows = [];
      [...tbody.querySelectorAll("tr")].forEach(tr => {
        const name = tr.querySelector(".name-input").value.trim();
        const totalVal = parseInt(tr.querySelector(".total-input").value, 10);
        const remainVal = parseInt(tr.querySelector(".remaining-input").value, 10);

        if (!name) return; // b·ªè d√≤ng tr·ªëng

        const total = Number.isFinite(totalVal) ? totalVal : 0;
        let remaining;
        if (resetRemaining) {
          remaining = total;
        } else {
          remaining = Number.isFinite(remainVal) ? remainVal : total;
        }

        rows.push({ name, total, remaining });
      });
      return rows;
    }

    addRowBtn.addEventListener("click", () => {
      createRow(tbody.querySelectorAll("tr").length, {
        name: "",
        total: 0,
        remaining: 0
      });
    });

    resetRemainBtn.addEventListener("click", () => {
      [...tbody.querySelectorAll("tr")].forEach(tr => {
        const totalVal = parseInt(tr.querySelector(".total-input").value, 10) || 0;
        tr.querySelector(".remaining-input").value = totalVal;
      });
    });

    saveResetBtn.addEventListener("click", () => {
      const prizes = collectRows({ resetRemaining: true });
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ prizes }));
      alert("ƒê√£ l∆∞u & reset s·ªë l∆∞·ª£ng. V√≤ng quay (index.html) s·∫Ω d√πng c·∫•u h√¨nh m·ªõi.");
    });

    saveCurrentBtn.addEventListener("click", () => {
      const prizes = collectRows({ resetRemaining: false });
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ prizes }));
      alert("ƒê√£ l∆∞u c·∫•u h√¨nh, gi·ªØ nguy√™n s·ªë c√≤n l·∫°i.");
    });

    clearAllBtn.addEventListener("click", () => {
      if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô c·∫•u h√¨nh qu√† t·∫∑ng?")) return;
      localStorage.removeItem(STORAGE_KEY);
      renderInitial();
      alert("ƒê√£ x√≥a c·∫•u h√¨nh. V√≤ng quay s·∫Ω d√πng m·∫∑c ƒë·ªãnh.");
    });

    renderInitial();
  </script>
</body>
<script src="pass.js"></script>

</html>
